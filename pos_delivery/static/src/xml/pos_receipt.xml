<?xml version="1.0" encoding="utf-8"?>
<templates id="template" xml:space="preserve">

    <t t-inherit="point_of_sale.OrderReceipt" t-inherit-mode="extension">
        <!-- Add customer information after the header and before the products -->
        <xpath expr="//ReceiptHeader" position="after">
            <!-- Add order creation date/time FIRST -->
            <t t-if="props.data.creation_date">
                <br/>
                <div class="text-center" style="font-size: 1.1em;">
                    <strong>Fecha y Hora:</strong><br/>
                    <strong style="font-size: 1.2em;"><t t-esc="props.data.creation_date"/></strong>
                </div>
                <br/>
            </t>
            
            <t t-if="props.data.partner and (props.data.partner.name or props.data.partner.street or props.data.partner.phone or props.data.partner.mobile)">
                <br/>
                <div class="text-center">--------------------------------</div>
                <div class="text-center fw-bold">INFORMACIÓN DEL CLIENTE</div>
                <div class="text-center">--------------------------------</div>
                
                <div t-if="props.data.partner.name">
                    <strong>Nombre:</strong> <t t-esc="props.data.partner.name"/>
                </div>
                
                <div t-if="props.data.partner.document_type or props.data.partner.document_number">
                    <strong>
                        <t t-if="props.data.partner.document_type">
                            <t t-esc="props.data.partner.document_type"/>:
                        </t>
                        <t t-else="">Documento:</t>
                    </strong>
                    <t t-esc="props.data.partner.document_number"/>
                </div>
                
                <div t-if="props.data.partner.vat">
                    <strong>NIT/VAT:</strong> <t t-esc="props.data.partner.vat"/>
                </div>
                
                <t t-if="props.data.partner.street or props.data.partner.street2 or props.data.partner.city">
                    <div>
                        <strong>Dirección:</strong><br/>
                        <t t-if="props.data.partner.street">
                            <t t-esc="props.data.partner.street"/><br/>
                        </t>
                        <t t-if="props.data.partner.street2">
                            <t t-esc="props.data.partner.street2"/><br/>
                        </t>
                        <t t-if="props.data.partner.city or props.data.partner.state_id or props.data.partner.zip">
                        <t t-if="props.data.partner.city">
                            <t t-esc="props.data.partner.city"/>
                        </t>
                        <t t-if="props.data.partner.state_id">
                            , <t t-esc="props.data.partner.state_id"/>
                        </t>
                        <t t-if="props.data.partner.zip">
                            - <t t-esc="props.data.partner.zip"/>
                            </t>
                            <br/>
                        </t>
                        <t t-if="props.data.partner.country_id">
                            <t t-esc="props.data.partner.country_id"/><br/>
                        </t>
                    </div>
                </t>
                
                <div t-if="props.data.partner.phone">
                    <strong>Teléfono:</strong> <t t-esc="props.data.partner.phone"/>
                </div>
                
                <div t-if="props.data.partner.mobile">
                    <strong>Celular:</strong> <t t-esc="props.data.partner.mobile"/>
                    </div>
                
                <div class="text-center">--------------------------------</div>
                <br/>
            </t>
        </xpath>
        
        <!-- Replace OrderWidget completely to show internal notes -->
        <xpath expr="//OrderWidget" position="replace">
            <div class="orderlines" t-if="props.data.orderlines?.length">
                <t t-foreach="props.data.orderlines" t-as="line" t-key="line_index">
                    <div class="orderline">
                        <!-- Product info -->
                        <div class="d-flex justify-content-between">
                            <div class="flex-fill">
                                <t t-esc="line.productName"/>
                            </div>
                            <div class="text-end">
                                <t t-esc="line.price"/>
                            </div>
                        </div>
                        
                        <!-- Quantity and unit price -->
                        <div class="d-flex justify-content-between text-muted" style="font-size: 0.9em;">
                            <div>
                                <t t-esc="line.qty"/> 
                                <t t-if="line.unit">
                                    <t t-esc="line.unit"/>
                                </t>
                                x <t t-esc="line.unitPrice"/>
                                <t t-if="line.discount">
                                    (Desc: <t t-esc="line.discount"/>)
                                </t>
                            </div>
                        </div>
                        
                        <!-- Customer Note -->
                        <div t-if="line.customerNote" class="customer-note p-2 my-1 rounded text-break" style="background-color: #fff3cd; font-size: 0.9em;">
                            <i class="fa fa-sticky-note me-1"/>
                            <em><t t-esc="line.customerNote"/></em>
                        </div>
                        
                        <!-- Internal Note -->
                        <div t-if="line.internalNote" class="internal-note p-2 my-1 rounded text-break" style="background-color: #f0f0f0; font-size: 0.9em;">
                            <i class="fa fa-file-text-o me-1"/>
                            <em><t t-esc="line.internalNote"/></em>
                        </div>
                    </div>
                </t>
            </div>
        </xpath>
    </t>

</templates>

